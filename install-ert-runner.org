#+TITLE: Batch File to Install ert-runner Package
#+OPTIONS: toc:2 num:nil ^:nil

This program installs the "ert-runner" package in the elpa
subdirectory, so that we can use it to run tests without loading
everything and the kitchen sink.

* Implementation
Check for local 'org package and load it if found.
#+begin_src emacs-lisp :tangle yes
  (when (getenv "ORG_HOME")
    (let ((org-lisp-dir (expand-file-name "lisp" (getenv "ORG_HOME"))))
      (when (file-directory-p org-lisp-dir)
        (add-to-list 'load-path org-lisp-dir)
        (require 'org))))
#+end_src

We need some setup for package module to get things in the right
place.
#+begin_src emacs-lisp :tangle yes
  (setq starter-kit-dir user-emacs-directory)

  (setq package-user-dir (concat starter-kit-dir "elpa"))
  (setq package-archives
        '(("gnu"         . "http://elpa.gnu.org/packages/")
          ("melpa"       . "http://melpa.milkbox.net/packages/")
          ("marmalade"   . "http://marmalade-repo.org/packages/")))
#+end_src

#+name: install-ert-runner
#+begin_src emacs-lisp :tangle yes
  (add-hook 'after-init-hook
            (lambda ()
              (princ (concat "package-user-dir is " package-user-dir ".\n"))
              (package-initialize)
              (unless (package-installed-p 'ert-runner)
                (princ "Trying to install ert-runner.\n")
                (package-install 'ert-runner))))

#+end_src
